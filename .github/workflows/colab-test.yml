name: Colab Integration Test

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # Run weekly to catch API changes
    - cron: '0 0 * * 0'

jobs:
  validate-notebook:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.10"
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install nbformat nbconvert jupyter
    
    - name: Validate notebook format
      run: |
        python -c "
import nbformat
import sys

try:
    with open('notebooks/NeuroSymbolic_T4_Demo.ipynb', 'r') as f:
        nb = nbformat.read(f, as_version=4)
    print('✓ Notebook format is valid')
    print(f'✓ Contains {len(nb.cells)} cells')
    sys.exit(0)
except Exception as e:
    print(f'✗ Notebook validation failed: {e}')
    sys.exit(1)
"
    
    - name: Check notebook metadata
      run: |
        python -c "
import json

with open('notebooks/NeuroSymbolic_T4_Demo.ipynb', 'r') as f:
    nb = json.load(f)

metadata = nb.get('metadata', {})
colab = metadata.get('colab', {})
accelerator = metadata.get('accelerator', '')

print('Notebook metadata:')
print(f'  GPU Type: {colab.get(\"gpuType\", \"Not specified\")}')
print(f'  Accelerator: {accelerator}')

if colab.get('gpuType') == 'T4':
    print('✓ Configured for T4 GPU')
else:
    print('⚠ Not explicitly configured for T4')
"
    
    - name: Test notebook can be converted
      run: |
        jupyter nbconvert --to script notebooks/NeuroSymbolic_T4_Demo.ipynb --stdout > /dev/null
        echo "✓ Notebook can be converted to script"